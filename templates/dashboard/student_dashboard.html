{% extends 'dashboard/base_dashboard.html' %}

{% block title %}Student Dashboard - {{ SITE_NAME }}{% endblock %}

{% block dashboard_content %}
<div class="dashboard-header">
    <div>
        <h1>Welcome, {{ user.first_name }}! ðŸ‘‹</h1>
        <p class="text-muted">Here's what's happening with your mentorship journey</p>
    </div>
    <a href="{% url 'mentorship:search' %}" class="btn btn-primary">
        <i data-feather="search"></i> Find Mentors
    </a>
</div>

<!-- Stats -->
<div class="dashboard-stats">
    <div class="stat-card">
        <div class="stat-card-icon">
            <i data-feather="file-text"></i>
        </div>
        <div class="stat-card-value">{{ pending_requests_count|default:0 }}</div>
        <div class="stat-card-label">Pending Requests</div>
    </div>
    <div class="stat-card">
        <div class="stat-card-icon" style="background: #d1fae5; color: #059669;">
            <i data-feather="check-circle"></i>
        </div>
        <div class="stat-card-value">{{ active_mentorships_count|default:0 }}</div>
        <div class="stat-card-label">Active Mentorships</div>
    </div>
    <div class="stat-card">
        <div class="stat-card-icon" style="background: #fef3c7; color: #d97706;">
            <i data-feather="users"></i>
        </div>
        <div class="stat-card-value">{{ following_count|default:0 }}</div>
        <div class="stat-card-label">Following</div>
    </div>
    <div class="stat-card">
        <div class="stat-card-icon" style="background: #fee2e2; color: #dc2626;">
            <i data-feather="trending-up"></i>
        </div>
        <div class="stat-card-value">{{ profile_completion|default:0 }}%</div>
        <div class="stat-card-label">Profile Complete</div>
    </div>
</div>

<!-- Mentor Feedback (from approved guest application) -->
{% for app in linked_applications_with_feedback %}
<div class="card mb-4" style="border-left: 4px solid #10b981;">
    <div class="card-body">
        <h4 class="mb-2"><i data-feather="message-circle" style="width:20px;height:20px;"></i> Feedback from {{ app.mentor.get_full_name }}</h4>
        <p class="text-muted mb-0">{{ app.mentor_feedback }}</p>
    </div>
</div>
{% endfor %}

<!-- Profile Completion Alert -->
{% if profile_completion < 80 %}
<div class="card mb-4" style="background: var(--primary-light); border-left: 4px solid var(--primary-color);">
    <div class="card-body flex justify-between items-center">
        <div>
            <h4 class="mb-1">Complete Your Profile</h4>
            <p class="text-muted mb-0">A complete profile helps mentors understand your goals better.</p>
        </div>
        <a href="{% url 'profiles:student_edit' %}" class="btn btn-primary">
            Complete Profile
        </a>
    </div>
</div>
{% endif %}

<div class="grid grid-2">
    <!-- Pending Requests -->
    <div class="card">
        <div class="card-body">
            <div class="flex justify-between items-center mb-4">
                <h3 class="mb-0">Pending Requests</h3>
                <a href="{% url 'mentorship:request_list' %}" class="text-primary text-sm">View all</a>
            </div>
            {% for request in pending_requests %}
            <div class="flex items-center gap-3 p-3 rounded-lg mb-2" style="background: var(--background-color);">
                <img src="{{ request.mentor.get_avatar_url }}" alt="" class="avatar">
                <div class="flex-1">
                    <div class="font-medium">{{ request.mentor.get_full_name }}</div>
                    <div class="text-sm text-muted">{{ request.subject|truncatewords:5 }}</div>
                </div>
                <span class="badge badge-warning">Pending</span>
            </div>
            {% empty %}
            <p class="text-muted text-center py-4">No pending requests</p>
            {% endfor %}
        </div>
    </div>

    <!-- Recommended Mentors -->
    <div class="card">
        <div class="card-body">
            <div class="flex justify-between items-center mb-4">
                <h3 class="mb-0">Recommended Mentors</h3>
                <a href="{% url 'mentorship:search' %}" class="text-primary text-sm">View all</a>
            </div>
            {% for mentor in recommended_mentors|slice:":4" %}
            <div class="flex items-center gap-3 p-3 rounded-lg mb-2" style="background: var(--background-color);">
                <img src="{{ mentor.user.get_avatar_url }}" alt="" class="avatar">
                <div class="flex-1">
                    <div class="font-medium">{{ mentor.user.get_full_name }}</div>
                    <div class="text-sm text-muted">{{ mentor.expertise }}</div>
                </div>
                <div class="rating">
                    <i data-feather="star" style="fill: #fbbf24; stroke: #fbbf24; width: 14px;"></i>
                    <span class="text-sm">{{ mentor.rating|floatformat:1 }}</span>
                </div>
            </div>
            {% empty %}
            <p class="text-muted text-center py-4">No mentors available</p>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Mobile Toggle Button -->
<button class="sidebar-toggle-mobile">
    <i data-feather="menu"></i>
</button>
<div class="sidebar-overlay"></div>
{% endblock %}
