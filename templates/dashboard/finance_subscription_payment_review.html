{% extends 'dashboard/base_dashboard.html' %}

{% block title %}Review Payment Proof - {{ payment_proof.user.get_full_name }}{% endblock %}

{% block dashboard_content %}
<div class="dashboard-header">
    <div>
        <h1><i data-feather="file-text" class="header-icon"></i> Review Payment Proof</h1>
        <p class="text-muted">Proof #{{ payment_proof.id }} - {{ payment_proof.user.get_full_name }}</p>
    </div>
    <a href="{% url 'dashboard:finance_subscription_payments' %}" class="btn btn-outline"><i data-feather="arrow-left"></i> Back to List</a>
</div>

<div class="card mb-4">
    <div class="card-body">
        <h3>Student Details</h3>
        <p><strong>Name:</strong> {{ payment_proof.user.get_full_name|default:payment_proof.user.email }}</p>
        <p><strong>Email:</strong> {{ payment_proof.user.email }}</p>
        <p><strong>Payment Type:</strong> {{ payment_proof.get_payment_type_display }}</p>
        <p><strong>Amount:</strong> ${{ payment_proof.amount }}</p>
        <p><strong>Submitted:</strong> {{ payment_proof.submitted_at|date:"F d, Y H:i" }}</p>
        <p><strong>Status:</strong> <span class="badge badge-{{ payment_proof.status }}">{{ payment_proof.get_status_display }}</span></p>
    </div>
</div>

<div class="card mb-4">
    <div class="card-body">
        <h3>Proof Document</h3>
        {% if payment_proof.proof_image %}
        <p><a href="{{ payment_proof.proof_image.url }}" target="_blank" class="btn btn-outline"><i data-feather="download"></i> Download Proof</a></p>
        <small class="text-muted">File: {{ payment_proof.proof_image.name }}</small>
        {% else %}
        <p class="text-muted">No proof file uploaded.</p>
        {% endif %}
    </div>
</div>

{% if payment_proof.status == 'pending' %}
<form method="post" class="card" id="review-form">
    <div class="card-body">
        {% csrf_token %}
        <input type="hidden" name="action" id="action_input" value="">
        <div class="flex gap-3">
            <button type="submit" onclick="document.getElementById('action_input').value='approve'" class="btn btn-primary">
                <i data-feather="check"></i> Approve Proof
            </button>
            <button type="submit" onclick="document.getElementById('action_input').value='reject'" class="btn btn-outline" style="border-color: #dc2626; color: #dc2626;">
                <i data-feather="x"></i> Reject
            </button>
        </div>
        <div class="mt-3">
            <label for="notes" class="form-label">Notes (optional)</label>
            <textarea name="notes" id="notes" class="form-control" rows="3" placeholder="Optional notes for the student">{{ payment_proof.notes }}</textarea>
        </div>
    </div>
</form>
{% else %}
<div class="card">
    <div class="card-body">
        <h3>Review Details</h3>
        <p><strong>Reviewed by:</strong> {{ payment_proof.reviewed_by.get_full_name|default:payment_proof.reviewed_by.email }}</p>
        <p><strong>Reviewed at:</strong> {{ payment_proof.reviewed_at|date:"F d, Y H:i" }}</p>
        {% if payment_proof.notes %}
        <p><strong>Notes:</strong> {{ payment_proof.notes }}</p>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}
