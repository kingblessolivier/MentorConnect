{% extends 'dashboard/base_dashboard.html' %}

{% block title %}My Sessions - {{ SITE_NAME }}{% endblock %}

{% block dashboard_content %}
<div class="dashboard-header">
    <div>
        <h1>My Sessions</h1>
        <p class="text-muted">View and manage your mentorship sessions</p>
    </div>
    {% if user.is_mentor %}
    <a href="{% url 'sessions_app:availability' %}" class="btn btn-primary">
        <i data-feather="clock"></i> Manage Availability
    </a>
    {% endif %}
</div>

<div class="card">
    {% for session in sessions %}
    <div class="flex items-start gap-4 p-4 border-b">
        {% if user.is_mentor %}
        <img src="{{ session.student.get_avatar_url }}" alt="" class="avatar">
        {% else %}
        <img src="{{ session.mentor.get_avatar_url }}" alt="" class="avatar">
        {% endif %}
        <div class="flex-1">
            <div class="flex justify-between items-start">
                <div>
                    <h4 class="mb-1">{{ session.title }}</h4>
                    <p class="text-muted text-sm">
                        with {% if user.is_mentor %}{{ session.student.get_full_name }}{% else %}{{ session.mentor.get_full_name }}{% endif %}
                    </p>
                </div>
                <span class="badge {% if session.status == 'scheduled' %}badge-warning{% elif session.status == 'completed' %}badge-success{% elif session.status == 'cancelled' %}badge-danger{% endif %}">
                    {{ session.get_status_display }}
                </span>
            </div>
            <div class="flex gap-4 mt-2 text-sm text-muted">
                <span><i data-feather="calendar" style="width:14px;"></i> {{ session.scheduled_time|date:"M d, Y" }}</span>
                <span><i data-feather="clock" style="width:14px;"></i> {{ session.scheduled_time|time:"H:i" }}</span>
                <span><i data-feather="watch" style="width:14px;"></i> {{ session.duration }} min</span>
            </div>

            {% if session.status == 'scheduled' %}
            <div class="flex gap-2 mt-3">
                {% if session.meeting_link %}
                <a href="{{ session.meeting_link }}" target="_blank" class="btn btn-sm btn-primary">
                    <i data-feather="video"></i> Join
                </a>
                {% endif %}
                <a href="{% url 'sessions_app:detail' session.pk %}" class="btn btn-sm btn-outline">View Details</a>
                <form method="post" action="{% url 'sessions_app:cancel' session.pk %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-ghost text-danger" onclick="return confirm('Cancel this session?')">Cancel</button>
                </form>
            </div>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <div class="p-5 text-center">
        <i data-feather="calendar" style="width: 48px; height: 48px; color: var(--text-muted);"></i>
        <h3 class="mt-3">No sessions yet</h3>
        <p class="text-muted">Your scheduled sessions will appear here.</p>
    </div>
    {% endfor %}
</div>

{% if page_obj.has_other_pages %}
<div class="pagination">
    {% if page_obj.has_previous %}<a href="?page={{ page_obj.previous_page_number }}">&laquo;</a>{% endif %}
    <span class="current">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}<a href="?page={{ page_obj.next_page_number }}">&raquo;</a>{% endif %}
</div>
{% endif %}

<!-- Mobile Toggle Button -->
<button class="sidebar-toggle-mobile">
    <i data-feather="menu"></i>
</button>
<div class="sidebar-overlay"></div>
{% endblock %}
