{% extends 'dashboard/base_dashboard.html' %}
{% load static %}

{% block title %}Find Mentors - {{ SITE_NAME }}{% endblock %}

{% block dashboard_content %}
<!-- Hero Section -->
<div class="search-hero">
    <div class="search-hero-content">
        <h1>Find Your Perfect Mentor</h1>
        <p>Connect with {{ total_mentors }}+ experienced professionals ready to guide your journey</p>

        <!-- Main Search Bar -->
        <form method="get" class="hero-search-form" id="searchForm">
            <div class="hero-search-box">
                <i data-feather="search"></i>
                <input type="text" name="q" value="{{ search }}" placeholder="Search by name, skills, expertise, company..." class="hero-search-input" autocomplete="off">
                <button type="submit" class="btn btn-primary btn-lg">Find Mentors</button>
            </div>

            <!-- Quick Filter Tags -->
            <div class="quick-tags">
                <span class="quick-tags-label">Popular:</span>
                {% for skill in popular_skills|slice:":8" %}
                <button type="button" class="quick-tag {% if skill in selected_skills %}active{% endif %}" onclick="toggleSkillFilter('{{ skill }}')">
                    {{ skill }}
                </button>
                {% endfor %}
            </div>

            <!-- Hidden inputs for maintaining filter state -->
            <input type="hidden" name="skills" id="skillsInput" value="{{ skills }}">
            <input type="hidden" name="expertise" id="expertiseInput" value="{{ expertise }}">
            <input type="hidden" name="min_rating" id="ratingInput" value="{{ min_rating }}">
            <input type="hidden" name="min_experience" id="experienceInput" value="{{ min_experience }}">
            <input type="hidden" name="price" id="priceInput" value="{{ price }}">
            <input type="hidden" name="sort" id="sortInput" value="{{ sort }}">
        </form>
    </div>
</div>

<div class="search-layout">
    <!-- Filters Sidebar -->
    <aside class="filters-sidebar">
        <div class="filters-header">
            <h3><i data-feather="sliders"></i> Filters</h3>
            {% if search or skills or expertise or min_rating or min_experience or price %}
            <a href="{% url 'mentorship:search' %}" class="clear-filters">Clear All</a>
            {% endif %}
        </div>

        <!-- Expertise Categories -->
        <div class="filter-section">
            <h4>Expertise</h4>
            <div class="filter-options expertise-list">
                {% for exp in expertise_areas %}
                <label class="filter-checkbox">
                    <input type="checkbox" name="expertise_check" value="{{ exp }}" {% if exp == expertise %}checked{% endif %} onchange="setExpertise('{{ exp }}')">
                    <span class="checkmark"></span>
                    <span class="label-text">{{ exp }}</span>
                </label>
                {% endfor %}
            </div>
        </div>

        <!-- Skills Filter -->
        <div class="filter-section">
            <h4>Skills</h4>
            <div class="skills-filter-list">
                {% for skill in popular_skills %}
                <button type="button" class="skill-filter-tag {% if skill in selected_skills %}active{% endif %}" onclick="toggleSkillFilter('{{ skill }}')">
                    {{ skill }}
                    {% if skill in selected_skills %}<i data-feather="x"></i>{% endif %}
                </button>
                {% endfor %}
            </div>
        </div>

        <!-- Rating Filter -->
        <div class="filter-section">
            <h4>Minimum Rating</h4>
            <div class="rating-filter">
                <label class="rating-option {% if min_rating == '' %}active{% endif %}">
                    <input type="radio" name="rating" value="" {% if min_rating == '' %}checked{% endif %} onchange="setRating('')">
                    <span>Any Rating</span>
                </label>
                <label class="rating-option {% if min_rating == '4.5' %}active{% endif %}">
                    <input type="radio" name="rating" value="4.5" {% if min_rating == '4.5' %}checked{% endif %} onchange="setRating('4.5')">
                    <span class="stars">★★★★★</span>
                    <span>4.5+</span>
                </label>
                <label class="rating-option {% if min_rating == '4' %}active{% endif %}">
                    <input type="radio" name="rating" value="4" {% if min_rating == '4' %}checked{% endif %} onchange="setRating('4')">
                    <span class="stars">★★★★☆</span>
                    <span>4.0+</span>
                </label>
                <label class="rating-option {% if min_rating == '3' %}active{% endif %}">
                    <input type="radio" name="rating" value="3" {% if min_rating == '3' %}checked{% endif %} onchange="setRating('3')">
                    <span class="stars">★★★☆☆</span>
                    <span>3.0+</span>
                </label>
            </div>
        </div>

        <!-- Experience Filter -->
        <div class="filter-section">
            <h4>Experience</h4>
            <div class="experience-filter">
                <label class="filter-checkbox">
                    <input type="radio" name="exp" value="" {% if min_experience == '' %}checked{% endif %} onchange="setExperience('')">
                    <span class="checkmark round"></span>
                    <span class="label-text">Any Experience</span>
                </label>
                <label class="filter-checkbox">
                    <input type="radio" name="exp" value="1" {% if min_experience == '1' %}checked{% endif %} onchange="setExperience('1')">
                    <span class="checkmark round"></span>
                    <span class="label-text">1+ years</span>
                </label>
                <label class="filter-checkbox">
                    <input type="radio" name="exp" value="3" {% if min_experience == '3' %}checked{% endif %} onchange="setExperience('3')">
                    <span class="checkmark round"></span>
                    <span class="label-text">3+ years</span>
                </label>
                <label class="filter-checkbox">
                    <input type="radio" name="exp" value="5" {% if min_experience == '5' %}checked{% endif %} onchange="setExperience('5')">
                    <span class="checkmark round"></span>
                    <span class="label-text">5+ years</span>
                </label>
                <label class="filter-checkbox">
                    <input type="radio" name="exp" value="10" {% if min_experience == '10' %}checked{% endif %} onchange="setExperience('10')">
                    <span class="checkmark round"></span>
                    <span class="label-text">10+ years</span>
                </label>
            </div>
        </div>

        <!-- Price Filter -->
        <div class="filter-section">
            <h4>Price</h4>
            <div class="price-filter">
                <label class="filter-checkbox">
                    <input type="radio" name="price_opt" value="" {% if price == '' %}checked{% endif %} onchange="setPrice('')">
                    <span class="checkmark round"></span>
                    <span class="label-text">All</span>
                </label>
                <label class="filter-checkbox">
                    <input type="radio" name="price_opt" value="free" {% if price == 'free' %}checked{% endif %} onchange="setPrice('free')">
                    <span class="checkmark round"></span>
                    <span class="label-text">Free Sessions</span>
                </label>
                <label class="filter-checkbox">
                    <input type="radio" name="price_opt" value="paid" {% if price == 'paid' %}checked{% endif %} onchange="setPrice('paid')">
                    <span class="checkmark round"></span>
                    <span class="label-text">Paid Sessions</span>
                </label>
            </div>
        </div>
    </aside>

    <!-- Main Results Area -->
    <main class="search-results">
        <!-- Results Header -->
        <div class="results-header">
            <div class="results-info">
                <span class="results-count">
                    {% if mentors %}{{ mentors|length }}{% if page_obj.paginator.count > mentors|length %} of {{ page_obj.paginator.count }}{% endif %}{% else %}0{% endif %} mentors found
                </span>
                {% if used_fallback %}
                <div class="fallback-note" style="color:#B45309; margin-top:6px;">
                    No mentors matched your filters — showing active mentors instead. Try clearing filters for better results.
                </div>
                {% endif %}
                {% if selected_skills %}
                <div class="active-filters">
                    {% for skill in selected_skills %}
                    <span class="active-filter">
                        {{ skill }}
                        <button onclick="removeSkill('{{ skill }}')" class="remove-filter"><i data-feather="x"></i></button>
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            <div class="sort-options">
                <label>Sort by:</label>
                <select id="sortSelect" onchange="setSort(this.value)" class="form-select sort-select">
                    <option value="-rating" {% if sort == '-rating' %}selected{% endif %}>Top Rated</option>
                    <option value="experience" {% if sort == 'experience' %}selected{% endif %}>Most Experienced</option>
                    <option value="reviews" {% if sort == 'reviews' %}selected{% endif %}>Most Reviews</option>
                    <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Newest</option>
                    <option value="price_low" {% if sort == 'price_low' %}selected{% endif %}>Price: Low to High</option>
                    <option value="price_high" {% if sort == 'price_high' %}selected{% endif %}>Price: High to Low</option>
                </select>
            </div>
        </div>

        <!-- Mentor Cards Grid -->
        <div class="mentors-grid">
            {% for mentor in mentors %}
            <div class="mentor-card-enhanced">
                {% if mentor.is_featured %}
                <div class="featured-badge">
                    <i data-feather="award"></i> Featured
                </div>
                {% endif %}

                <div class="mentor-card-top">
                    <div class="mentor-avatar-wrapper">
                        <img src="{{ mentor.user.get_avatar_url }}" alt="{{ mentor.user.get_full_name }}" class="mentor-avatar">
                        <span class="online-status"></span>
                    </div>
                    <div class="mentor-intro">
                        <h3 class="mentor-name">{{ mentor.user.get_full_name }}</h3>
                        <p class="mentor-headline">{{ mentor.headline|default:mentor.expertise }}</p>
                        {% if mentor.company or mentor.job_title %}
                        <p class="mentor-position">
                            <i data-feather="briefcase"></i>
                            {{ mentor.job_title }}{% if mentor.company %} at {{ mentor.company }}{% endif %}
                        </p>
                        {% endif %}
                    </div>
                </div>

                <div class="mentor-card-body">
                    <p class="mentor-bio">{{ mentor.bio|truncatewords:25|default:"Passionate about sharing knowledge and helping others grow in their careers." }}</p>

                    <div class="mentor-expertise">
                        <span class="expertise-tag">
                            <i data-feather="target"></i>
                            {{ mentor.expertise }}
                        </span>
                    </div>

                    <div class="mentor-skills">
                        {% for skill in mentor.get_skills_list|slice:":4" %}
                        <span class="skill-tag">{{ skill }}</span>
                        {% endfor %}
                        {% if mentor.get_skills_list|length > 4 %}
                        <span class="skill-tag more">+{{ mentor.get_skills_list|length|add:"-4" }}</span>
                        {% endif %}
                    </div>
                </div>

                <div class="mentor-card-stats">
                    <div class="stat">
                        <div class="stat-icon rating">
                            <i data-feather="star"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value">{{ mentor.rating|floatformat:1 }}</span>
                            <span class="stat-label">Rating</span>
                        </div>
                    </div>
                    <div class="stat">
                        <div class="stat-icon experience">
                            <i data-feather="award"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value">{{ mentor.experience_years }}</span>
                            <span class="stat-label">Years Exp</span>
                        </div>
                    </div>
                    <div class="stat">
                        <div class="stat-icon reviews">
                            <i data-feather="message-square"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value">{{ mentor.total_reviews }}</span>
                            <span class="stat-label">Reviews</span>
                        </div>
                    </div>
                    <div class="stat">
                        <div class="stat-icon price">
                            <i data-feather="dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value">{% if mentor.hourly_rate > 0 %}${{ mentor.hourly_rate|floatformat:0 }}{% else %}Free{% endif %}</span>
                            <span class="stat-label">Per Hour</span>
                        </div>
                    </div>
                </div>

                <div class="mentor-card-actions">
                    <a href="{% url 'profiles:mentor_detail' mentor.user.id %}" class="btn btn-outline">
                        <i data-feather="user"></i> View Profile
                    </a>
                    <a href="{% url 'mentorship:create_request' mentor.user.id %}" class="btn btn-primary">
                        <i data-feather="send"></i> Request
                    </a>
                    <a href="{% url 'sessions_app:mentor_calendar' mentor.user.id %}" class="btn btn-info">
                        <i data-feather="calendar"></i> View Mentor Schedule
                    </a>
                    <button type="button" class="btn btn-ghost rate-btn" onclick="openRatingModal('{{ mentor.user.id }}', '{{ mentor.user.get_full_name }}', '{{ mentor.user.get_avatar_url }}')">
                        <i data-feather="star"></i>
                    </button>
                </div>
            </div>
            {% empty %}
            <div class="no-results">
                <div class="no-results-icon">
                    <i data-feather="search"></i>
                </div>
                <h3>No mentors found</h3>
                <p>Try adjusting your filters or search terms</p>
                <a href="{% url 'mentorship:search' %}" class="btn btn-primary">Clear Filters</a>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
        <div class="pagination-container">
            <div class="pagination">
                {% if page_obj.has_previous %}
                <a href="?page=1&q={{ search }}&skills={{ skills }}&expertise={{ expertise }}&min_rating={{ min_rating }}&min_experience={{ min_experience }}&price={{ price }}&sort={{ sort }}" class="page-btn" title="First">
                    <i data-feather="chevrons-left"></i>
                </a>
                <a href="?page={{ page_obj.previous_page_number }}&q={{ search }}&skills={{ skills }}&expertise={{ expertise }}&min_rating={{ min_rating }}&min_experience={{ min_experience }}&price={{ price }}&sort={{ sort }}" class="page-btn">
                    <i data-feather="chevron-left"></i>
                </a>
                {% endif %}

                <span class="page-info">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}&q={{ search }}&skills={{ skills }}&expertise={{ expertise }}&min_rating={{ min_rating }}&min_experience={{ min_experience }}&price={{ price }}&sort={{ sort }}" class="page-btn">
                    <i data-feather="chevron-right"></i>
                </a>
                <a href="?page={{ page_obj.paginator.num_pages }}&q={{ search }}&skills={{ skills }}&expertise={{ expertise }}&min_rating={{ min_rating }}&min_experience={{ min_experience }}&price={{ price }}&sort={{ sort }}" class="page-btn" title="Last">
                    <i data-feather="chevrons-right"></i>
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </main>

    <!-- Right Sidebar - Featured & Suggestions -->
    <aside class="suggestions-sidebar">
        {% if featured_mentors %}
        <div class="sidebar-section">
            <h4><i data-feather="award"></i> Featured Mentors</h4>
            {% for mentor in featured_mentors %}
            <a href="{% url 'profiles:mentor_detail' mentor.user.id %}" class="featured-mentor-card">
                <img src="{{ mentor.user.get_avatar_url }}" alt="" class="featured-avatar">
                <div class="featured-info">
                    <span class="featured-name">{{ mentor.user.get_full_name }}</span>
                    <span class="featured-expertise">{{ mentor.expertise }}</span>
                    <span class="featured-rating">
                        <i data-feather="star"></i> {{ mentor.rating|floatformat:1 }}
                    </span>
                </div>
            </a>
            {% endfor %}
        </div>
        {% endif %}

        <div class="sidebar-section">
            <h4><i data-feather="trending-up"></i> Browse by Category</h4>
            <div class="category-list">
                {% for exp in expertise_areas|slice:":8" %}
                <a href="?expertise={{ exp }}" class="category-item {% if exp == expertise %}active{% endif %}">
                    {{ exp }}
                </a>
                {% endfor %}
            </div>
        </div>

        <div class="sidebar-section stats-section">
            <h4><i data-feather="bar-chart-2"></i> Platform Stats</h4>
            <div class="platform-stat">
                <span class="stat-number">{{ total_mentors }}</span>
                <span class="stat-text">Active Mentors</span>
            </div>
            <div class="platform-stat">
                <span class="stat-number">{{ total_sessions }}</span>
                <span class="stat-text">Sessions Completed</span>
            </div>
        </div>
    </aside>
</div>

<!-- Mobile Filter Button -->
<button class="mobile-filter-btn" onclick="toggleMobileFilters()">
    <i data-feather="sliders"></i> Filters
</button>

<!-- Mobile Filter Overlay -->
<div class="mobile-filter-overlay" id="mobileFilterOverlay" onclick="toggleMobileFilters()"></div>

<!-- Rating Modal -->
<div class="modal-overlay" id="ratingModal">
    <div class="modal-container rating-modal">
        <div class="modal-header">
            <h3>Rate Mentor</h3>
            <button class="modal-close" onclick="closeRatingModal()">
                <i data-feather="x"></i>
            </button>
        </div>
        <form id="ratingForm" method="post" action="">
            {% csrf_token %}
            <div class="modal-body">
                <div class="rating-mentor-info">
                    <img src="" alt="" id="ratingMentorAvatar" class="rating-mentor-avatar">
                    <span id="ratingMentorName" class="rating-mentor-name"></span>
                </div>

                <div class="star-rating-input">
                    <input type="hidden" name="rating" id="ratingValue" value="0" required>
                    <div class="stars-container" id="starsContainer">
                        <button type="button" class="star-btn" data-rating="1"><i data-feather="star"></i></button>
                        <button type="button" class="star-btn" data-rating="2"><i data-feather="star"></i></button>
                        <button type="button" class="star-btn" data-rating="3"><i data-feather="star"></i></button>
                        <button type="button" class="star-btn" data-rating="4"><i data-feather="star"></i></button>
                        <button type="button" class="star-btn" data-rating="5"><i data-feather="star"></i></button>
                    </div>
                    <span class="rating-text" id="ratingText">Select a rating</span>
                </div>

                <div class="form-group">
                    <label class="form-label">Review Title (Optional)</label>
                    <input type="text" name="title" class="form-input" placeholder="Summarize your experience">
                </div>

                <div class="form-group">
                    <label class="form-label">Your Review *</label>
                    <textarea name="content" class="form-textarea" rows="4" placeholder="Share your experience with this mentor..." required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeRatingModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">
                    <i data-feather="send"></i> Submit Review
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
/* Search Hero */
.search-hero {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
    border-radius: var(--card-radius);
    padding: 3rem 2rem;
    margin-bottom: 2rem;
    color: white;
    text-align: center;
}

.search-hero h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    color: white;
}

.search-hero p {
    opacity: 0.9;
    margin-bottom: 1.5rem;
}

.hero-search-form {
    max-width: 700px;
    margin: 0 auto;
}

.hero-search-box {
    display: flex;
    background: white;
    border-radius: 50px;
    padding: 0.5rem;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}

.hero-search-box i {
    color: var(--text-muted);
    margin: auto 0 auto 1rem;
    width: 20px;
    height: 20px;
}

.hero-search-input {
    flex: 1;
    border: none;
    padding: 0.75rem 1rem;
    font-size: 1rem;
    background: transparent;
    outline: none;
    color: var(--text-primary);
}

.hero-search-box .btn {
    border-radius: 50px;
    padding: 0.75rem 1.5rem;
}

.quick-tags {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 1.25rem;
}

.quick-tags-label {
    font-size: 0.875rem;
    opacity: 0.9;
    margin-right: 0.5rem;
}

.quick-tag {
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
    padding: 0.375rem 0.875rem;
    border-radius: 50px;
    font-size: 0.8125rem;
    cursor: pointer;
    transition: all 0.2s;
}

.quick-tag:hover, .quick-tag.active {
    background: white;
    color: var(--primary-color);
}

/* Search Layout */
.search-layout {
    display: grid;
    grid-template-columns: 260px 1fr 280px;
    gap: 1.5rem;
}

/* Filters Sidebar */
.filters-sidebar {
    background: var(--surface-color);
    border-radius: var(--card-radius);
    padding: 1.25rem;
    height: fit-content;
    position: sticky;
    top: 80px;
}

.filters-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-color, #e5e7eb);
}

.filters-header h3 {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
    font-size: 1rem;
}

.filters-header h3 i {
    width: 18px;
    height: 18px;
}

.clear-filters {
    font-size: 0.8125rem;
    color: var(--error-color);
}

.filter-section {
    margin-bottom: 1.5rem;
}

.filter-section h4 {
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    color: var(--text-primary);
}

/* Skills Filter Tags */
.skills-filter-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.skill-filter-tag {
    background: var(--background-color);
    border: 1px solid var(--border-color, #e5e7eb);
    color: var(--text-secondary);
    padding: 0.375rem 0.75rem;
    border-radius: 50px;
    font-size: 0.8125rem;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.skill-filter-tag:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
}

.skill-filter-tag.active {
    background: var(--primary-color);
    border-color: var(--primary-color);
    color: white;
}

.skill-filter-tag i {
    width: 12px;
    height: 12px;
}

/* Filter Checkbox */
.filter-checkbox {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    padding: 0.5rem 0;
    font-size: 0.875rem;
}

.filter-checkbox input {
    display: none;
}

.checkmark {
    width: 18px;
    height: 18px;
    border: 2px solid var(--border-color, #d1d5db);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.checkmark.round {
    border-radius: 50%;
}

.filter-checkbox input:checked + .checkmark {
    background: var(--primary-color);
    border-color: var(--primary-color);
}

.filter-checkbox input:checked + .checkmark::after {
    content: '✓';
    color: white;
    font-size: 10px;
}

/* Rating Filter */
.rating-filter {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.rating-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    border-radius: var(--button-radius);
    cursor: pointer;
    transition: background 0.2s;
}

.rating-option:hover {
    background: var(--background-color);
}

.rating-option input {
    display: none;
}

.rating-option.active {
    background: var(--primary-light);
}

.rating-option .stars {
    color: #fbbf24;
    font-size: 0.75rem;
    letter-spacing: -1px;
}

/* Results Area */
.search-results {
    min-width: 0;
}

.results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.results-count {
    font-weight: 600;
    color: var(--text-primary);
}

.active-filters {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.active-filter {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    background: var(--primary-light);
    color: var(--primary-color);
    padding: 0.25rem 0.5rem 0.25rem 0.75rem;
    border-radius: 50px;
    font-size: 0.8125rem;
}

.remove-filter {
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    color: var(--primary-color);
    display: flex;
}

.remove-filter i {
    width: 14px;
    height: 14px;
}

.sort-options {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.sort-options label {
    font-size: 0.875rem;
    color: var(--text-muted);
}

.sort-select {
    min-width: 160px;
}

/* Mentors Grid */
.mentors-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: 1.5rem;
}

/* Enhanced Mentor Card */
.mentor-card-enhanced {
    background: var(--surface-color);
    border-radius: var(--card-radius);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
    transition: all 0.3s ease;
    position: relative;
}

.mentor-card-enhanced:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.featured-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 50px;
    font-size: 0.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    z-index: 1;
}

.featured-badge i {
    width: 12px;
    height: 12px;
}

.mentor-card-top {
    display: flex;
    gap: 1rem;
    padding: 1.5rem 1.5rem 1rem;
}

.mentor-avatar-wrapper {
    position: relative;
    flex-shrink: 0;
}

.mentor-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid var(--surface-color);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.online-status {
    position: absolute;
    bottom: 4px;
    right: 4px;
    width: 14px;
    height: 14px;
    background: #22c55e;
    border: 2px solid var(--surface-color);
    border-radius: 50%;
}

.mentor-intro {
    flex: 1;
    min-width: 0;
}

.mentor-name {
    font-size: 1.125rem;
    font-weight: 700;
    margin: 0 0 0.25rem;
    color: var(--text-primary);
}

.mentor-headline {
    font-size: 0.9375rem;
    color: var(--text-secondary);
    margin: 0 0 0.375rem;
    line-height: 1.4;
}

.mentor-position {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    font-size: 0.8125rem;
    color: var(--text-muted);
    margin: 0;
}

.mentor-position i {
    width: 14px;
    height: 14px;
}

.mentor-card-body {
    padding: 0 1.5rem 1rem;
}

.mentor-bio {
    font-size: 0.875rem;
    color: var(--text-secondary);
    line-height: 1.6;
    margin: 0 0 1rem;
}

.mentor-expertise {
    margin-bottom: 0.75rem;
}

.expertise-tag {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    background: var(--primary-light);
    color: var(--primary-color);
    padding: 0.375rem 0.75rem;
    border-radius: var(--button-radius);
    font-size: 0.8125rem;
    font-weight: 600;
}

.expertise-tag i {
    width: 14px;
    height: 14px;
}

.mentor-skills {
    display: flex;
    flex-wrap: wrap;
    gap: 0.375rem;
}

.mentor-skills .skill-tag {
    background: var(--background-color);
    color: var(--text-secondary);
    padding: 0.25rem 0.625rem;
    border-radius: var(--button-radius);
    font-size: 0.75rem;
}

.mentor-skills .skill-tag.more {
    background: var(--border-color, #e5e7eb);
    color: var(--text-muted);
}

.mentor-card-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    border-top: 1px solid var(--border-color, #e5e7eb);
    border-bottom: 1px solid var(--border-color, #e5e7eb);
}

.mentor-card-stats .stat {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.875rem 0.5rem;
    border-right: 1px solid var(--border-color, #e5e7eb);
}

.mentor-card-stats .stat:last-child {
    border-right: none;
}

.stat-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.stat-icon i {
    width: 16px;
    height: 16px;
}

.stat-icon.rating {
    background: #fef3c7;
    color: #d97706;
}

.stat-icon.experience {
    background: #dbeafe;
    color: #2563eb;
}

.stat-icon.reviews {
    background: #d1fae5;
    color: #059669;
}

.stat-icon.price {
    background: #f3e8ff;
    color: #9333ea;
}

.stat-info {
    display: flex;
    flex-direction: column;
}

.stat-value {
    font-weight: 700;
    font-size: 0.9375rem;
    color: var(--text-primary);
}

.stat-label {
    font-size: 0.6875rem;
    color: var(--text-muted);
}

.mentor-card-actions {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 0.75rem;
    padding: 1rem 1.5rem 1.5rem;
}

.mentor-card-actions .btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.mentor-card-actions .btn i {
    width: 16px;
    height: 16px;
}

.rate-btn {
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border-color, #e5e7eb);
    border-radius: var(--button-radius);
    background: transparent;
    color: #fbbf24;
    transition: all 0.2s;
}

.rate-btn:hover {
    background: #fef3c7;
    border-color: #fbbf24;
}

.rate-btn i {
    fill: #fbbf24;
}

/* No Results */
.no-results {
    grid-column: 1 / -1;
    text-align: center;
    padding: 4rem 2rem;
    background: var(--surface-color);
    border-radius: var(--card-radius);
}

.no-results-icon {
    width: 80px;
    height: 80px;
    background: var(--background-color);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1.5rem;
}

.no-results-icon i {
    width: 40px;
    height: 40px;
    color: var(--text-muted);
}

.no-results h3 {
    margin-bottom: 0.5rem;
}

.no-results p {
    color: var(--text-muted);
    margin-bottom: 1.5rem;
}

/* Suggestions Sidebar */
.suggestions-sidebar {
    position: sticky;
    top: 80px;
    height: fit-content;
}

.sidebar-section {
    background: var(--surface-color);
    border-radius: var(--card-radius);
    padding: 1.25rem;
    margin-bottom: 1rem;
}

.sidebar-section h4 {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    margin: 0 0 1rem;
    color: var(--text-primary);
}

.sidebar-section h4 i {
    width: 16px;
    height: 16px;
    color: var(--primary-color);
}

/* Featured Mentor Card */
.featured-mentor-card {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    border-radius: var(--button-radius);
    text-decoration: none;
    transition: background 0.2s;
    margin-bottom: 0.5rem;
}

.featured-mentor-card:hover {
    background: var(--background-color);
}

.featured-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
}

.featured-info {
    flex: 1;
    min-width: 0;
}

.featured-name {
    display: block;
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--text-primary);
    margin-bottom: 0.125rem;
}

.featured-expertise {
    display: block;
    font-size: 0.75rem;
    color: var(--text-muted);
}

.featured-rating {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.75rem;
    color: #d97706;
    margin-top: 0.25rem;
}

.featured-rating i {
    width: 12px;
    height: 12px;
    fill: currentColor;
}

/* Category List */
.category-list {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.category-item {
    padding: 0.5rem 0.75rem;
    border-radius: var(--button-radius);
    text-decoration: none;
    color: var(--text-secondary);
    font-size: 0.875rem;
    transition: all 0.2s;
}

.category-item:hover {
    background: var(--background-color);
    color: var(--primary-color);
}

.category-item.active {
    background: var(--primary-light);
    color: var(--primary-color);
    font-weight: 500;
}

/* Platform Stats */
.stats-section {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
    color: white;
}

.stats-section h4 {
    color: white;
}

.stats-section h4 i {
    color: white;
}

.platform-stat {
    display: flex;
    flex-direction: column;
    margin-bottom: 1rem;
}

.platform-stat:last-child {
    margin-bottom: 0;
}

.stat-number {
    font-size: 1.5rem;
    font-weight: 700;
}

.stat-text {
    font-size: 0.8125rem;
    opacity: 0.9;
}

/* Pagination */
.pagination-container {
    margin-top: 2rem;
    display: flex;
    justify-content: center;
}

.pagination {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.page-btn {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--button-radius);
    background: var(--surface-color);
    color: var(--text-secondary);
    text-decoration: none;
    transition: all 0.2s;
}

.page-btn:hover {
    background: var(--primary-light);
    color: var(--primary-color);
}

.page-btn i {
    width: 18px;
    height: 18px;
}

.page-info {
    padding: 0 1rem;
    font-size: 0.875rem;
    color: var(--text-muted);
}

/* Mobile Filter Button */
.mobile-filter-btn {
    display: none;
    position: fixed;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%);
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 0.875rem 1.5rem;
    border-radius: 50px;
    font-weight: 600;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    z-index: 90;
    cursor: pointer;
}

.mobile-filter-btn i {
    width: 18px;
    height: 18px;
    margin-right: 0.5rem;
}

.mobile-filter-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    z-index: 98;
}

.mobile-filter-overlay.active {
    display: block;
}

/* Responsive */
@media (max-width: 1200px) {
    .search-layout {
        grid-template-columns: 240px 1fr;
    }
    .suggestions-sidebar {
        display: none;
    }
}

@media (max-width: 900px) {
    .search-layout {
        grid-template-columns: 1fr;
    }

    .filters-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        width: 300px;
        z-index: 99;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        overflow-y: auto;
        border-radius: 0;
    }

    .filters-sidebar.open {
        transform: translateX(0);
    }

    .mobile-filter-btn {
        display: flex;
        align-items: center;
    }

    .mentors-grid {
        grid-template-columns: 1fr;
    }

    .hero-search-box {
        flex-direction: column;
        border-radius: var(--card-radius);
    }

    .hero-search-box .btn {
        width: 100%;
        border-radius: var(--button-radius);
    }
}

@media (max-width: 600px) {
    .search-hero {
        padding: 2rem 1rem;
    }

    .search-hero h1 {
        font-size: 1.5rem;
    }

    .quick-tags {
        display: none;
    }

    .mentor-card-stats {
        grid-template-columns: repeat(2, 1fr);
    }

    .mentor-card-stats .stat:nth-child(2) {
        border-right: none;
    }

    .mentor-card-stats .stat:nth-child(3),
    .mentor-card-stats .stat:nth-child(4) {
        border-top: 1px solid var(--border-color, #e5e7eb);
    }

    .mentor-card-actions {
        grid-template-columns: 1fr;
    }

    .rate-btn {
        display: none;
    }
}

/* Rating Modal Styles */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
    padding: 1rem;
}

.modal-overlay.active {
    opacity: 1;
    visibility: visible;
}

.modal-container {
    background: var(--surface-color);
    border-radius: var(--card-radius);
    width: 100%;
    max-width: 480px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    transform: translateY(-20px);
    transition: transform 0.3s;
    overflow: hidden;
}

.modal-overlay.active .modal-container {
    transform: translateY(0);
}

.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color, #e5e7eb);
}

.modal-header h3 {
    margin: 0;
}

.modal-close {
    background: none;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--text-secondary);
    border-radius: var(--button-radius);
}

.modal-close:hover {
    background: var(--background-color);
}

.modal-body {
    padding: 1.5rem;
    overflow-y: auto;
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
    padding: 1rem 1.5rem;
    border-top: 1px solid var(--border-color, #e5e7eb);
}

/* Rating Modal Specific */
.rating-mentor-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--background-color);
    border-radius: var(--button-radius);
    margin-bottom: 1.5rem;
}

.rating-mentor-avatar {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    object-fit: cover;
}

.rating-mentor-name {
    font-weight: 600;
    font-size: 1.125rem;
    color: var(--text-primary);
}

.star-rating-input {
    text-align: center;
    margin-bottom: 1.5rem;
}

.stars-container {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
}

.star-btn {
    background: none;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    transition: transform 0.2s;
}

.star-btn:hover {
    transform: scale(1.2);
}

.star-btn i {
    width: 36px;
    height: 36px;
    color: #d1d5db;
    stroke-width: 1.5;
    transition: all 0.2s;
}

.star-btn.active i,
.star-btn.hover i {
    color: #fbbf24;
    fill: #fbbf24;
}

.rating-text {
    font-size: 0.9375rem;
    color: var(--text-muted);
}

.rating-text.rated {
    color: #d97706;
    font-weight: 600;
}
</style>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
// Filter functions
function toggleSkillFilter(skill) {
    const input = document.getElementById('skillsInput');
    let skills = input.value ? input.value.split(',').map(s => s.trim()).filter(s => s) : [];

    const index = skills.indexOf(skill);
    if (index > -1) {
        skills.splice(index, 1);
    } else {
        skills.push(skill);
    }

    input.value = skills.join(',');
    document.getElementById('searchForm').submit();
}

function removeSkill(skill) {
    const input = document.getElementById('skillsInput');
    let skills = input.value.split(',').map(s => s.trim()).filter(s => s && s !== skill);
    input.value = skills.join(',');
    document.getElementById('searchForm').submit();
}

function setExpertise(expertise) {
    document.getElementById('expertiseInput').value = expertise;
    document.getElementById('searchForm').submit();
}

function setRating(rating) {
    document.getElementById('ratingInput').value = rating;
    document.getElementById('searchForm').submit();
}

function setExperience(exp) {
    document.getElementById('experienceInput').value = exp;
    document.getElementById('searchForm').submit();
}

function setPrice(price) {
    document.getElementById('priceInput').value = price;
    document.getElementById('searchForm').submit();
}

function setSort(sort) {
    document.getElementById('sortInput').value = sort;
    document.getElementById('searchForm').submit();
}

// Mobile filter toggle
function toggleMobileFilters() {
    const sidebar = document.querySelector('.filters-sidebar');
    const overlay = document.getElementById('mobileFilterOverlay');
    sidebar.classList.toggle('open');
    overlay.classList.toggle('active');
}

// Rating Modal Functions
let currentMentorId = null;

function openRatingModal(mentorId, mentorName, mentorAvatar) {
    currentMentorId = mentorId;
    document.getElementById('ratingMentorName').textContent = mentorName;
    document.getElementById('ratingMentorAvatar').src = mentorAvatar;
    document.getElementById('ratingForm').action = `/mentorship/review/${mentorId}/`;
    document.getElementById('ratingValue').value = 0;
    document.getElementById('ratingText').textContent = 'Select a rating';
    document.getElementById('ratingText').classList.remove('rated');

    // Reset stars
    document.querySelectorAll('.star-btn').forEach(btn => {
        btn.classList.remove('active');
    });

    // Reset form
    document.getElementById('ratingForm').reset();

    document.getElementById('ratingModal').classList.add('active');

    // Re-initialize feather icons in modal
    if (typeof feather !== 'undefined') {
        feather.replace();
    }
}

function closeRatingModal() {
    document.getElementById('ratingModal').classList.remove('active');
    currentMentorId = null;
}

// Star rating interaction
document.addEventListener('DOMContentLoaded', function() {
    const starsContainer = document.getElementById('starsContainer');
    const ratingValue = document.getElementById('ratingValue');
    const ratingText = document.getElementById('ratingText');
    const starButtons = document.querySelectorAll('.star-btn');

    const ratingTexts = {
        1: 'Poor',
        2: 'Fair',
        3: 'Good',
        4: 'Very Good',
        5: 'Excellent'
    };

    starButtons.forEach(btn => {
        btn.addEventListener('mouseenter', function() {
            const rating = parseInt(this.dataset.rating);
            highlightStars(rating, 'hover');
        });

        btn.addEventListener('mouseleave', function() {
            const currentRating = parseInt(ratingValue.value) || 0;
            highlightStars(currentRating, 'active');
        });

        btn.addEventListener('click', function() {
            const rating = parseInt(this.dataset.rating);
            ratingValue.value = rating;
            highlightStars(rating, 'active');
            ratingText.textContent = ratingTexts[rating];
            ratingText.classList.add('rated');
        });
    });

    function highlightStars(rating, className) {
        starButtons.forEach(btn => {
            btn.classList.remove('active', 'hover');
            if (parseInt(btn.dataset.rating) <= rating) {
                btn.classList.add(className);
            }
        });
    }
});

// Close modal on overlay click
document.getElementById('ratingModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeRatingModal();
    }
});

// Close modal on Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeRatingModal();
    }
});

// Form validation
document.getElementById('ratingForm').addEventListener('submit', function(e) {
    const rating = document.getElementById('ratingValue').value;
    if (!rating || rating === '0') {
        e.preventDefault();
        alert('Please select a rating');
        return false;
    }
});

// Initialize feather icons
if (typeof feather !== 'undefined') {
    feather.replace();
}
</script>
{% endblock %}
